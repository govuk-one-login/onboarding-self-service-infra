AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31
Description: |
  onboarding-infrastructure test template version: v0.0.1
  CloudFormation template defines a single resource for testing pipeline deployment with.

Parameters:
  Environment:
    Description: "The environment to deploy the stack into."
    Type: "String"
    Default: local
    AllowedValues:
      - "local"
      - "development"
      - "build"
      - "staging"
      - "integration"
      - "production"
  LocalName:
    Description: Unique name used for ephemeral environments
    Type: String
    Default: ""

Rules:
  LocalNameRequiredForLocalEnvironment:
    RuleCondition: !Equals [ !Ref Environment, "local" ]
    Assertions:
      - Assert: !Not [ !Equals [ !Ref LocalName, "" ] ]
        AssertDescription: >
          Must specify LocalName when Environment is "local"
  LocalNameEmptyForNotLocalEnvironment:
    RuleCondition: !Not [ !Equals [ !Ref Environment, "local" ] ]
    Assertions:
      - Assert: !Equals [ !Ref LocalName, "" ]
        AssertDescription: >
          Must not specify LocalName when Environment is not "local"  

Outputs:
  TestParam:
    Description: Name of the test parameter
    Value: !Ref TestSSMParameter
    Export:
      Name: !Sub "onboarding-infra-test-config-test-parameter"

Resources:
  TestSSMParameter:
    Type: AWS::SSM::Parameter
    Properties:
      Description: The test parameter
      Name: !Sub "/test/${Environment}${LocalName}/test-parameter"
      Type: String
      Value: "This is a test parameter, created by the stack 'onboarding-infra-test-config'"

